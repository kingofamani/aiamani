(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1312:(e,t,a)=>{Promise.resolve().then(a.bind(a,1773))},1773:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>X});var r=a(5155),s=a(2115),n=a(9708),l=a(2085),i=a(2596),d=a(9688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,d.QP)((0,i.$)(t))}let c=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 disabled:bg-primary/60 disabled:text-primary-foreground/80",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:bg-destructive/60 disabled:text-destructive-foreground/80",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground disabled:border-input/60 disabled:text-muted-foreground disabled:hover:bg-background disabled:hover:text-muted-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 disabled:bg-secondary/60 disabled:text-secondary-foreground/80",ghost:"hover:bg-accent hover:text-accent-foreground disabled:text-muted-foreground disabled:hover:bg-transparent",link:"text-primary underline-offset-4 hover:underline disabled:text-primary/60 disabled:no-underline disabled:hover:no-underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=s.forwardRef((e,t)=>{let{className:a,variant:s,size:l,asChild:i=!1,...d}=e,u=i?n.DX:"button";return(0,r.jsx)(u,{className:o(c({variant:s,size:l,className:a})),ref:t,...d})});u.displayName="Button";let m=s.forwardRef((e,t)=>{let{className:a,type:s,...n}=e;return(0,r.jsx)("input",{type:s,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});m.displayName="Input";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:o("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});f.displayName="Card";let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:o("flex flex-col space-y-1.5 p-6",a),...s})});p.displayName="CardHeader";let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:o("text-2xl font-semibold leading-none tracking-tight",a),...s})});g.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:o("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:o("p-6 pt-0",a),...s})});x.displayName="CardContent";let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:o("flex items-center p-6 pt-0",a),...s})});h.displayName="CardFooter";let v=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),y=s.forwardRef((e,t)=>{let{className:a,variant:s,...n}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:o(v({variant:s}),a),...n})});y.displayName="Alert";let b=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:o("mb-1 font-medium leading-none tracking-tight",a),...s})});b.displayName="AlertTitle";let N=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:o("text-sm [&_p]:leading-relaxed",a),...s})});N.displayName="AlertDescription";var w=a(7270),I=a(4843);let j=e=>"♥"===e||"♦"===e?"text-primary":"text-foreground";function T(e){let{card:t,isFaceUp:a=!1,className:s,onClick:n}=e,l="w-20 h-28 md:w-24 md:h-36 border-2 rounded-lg flex flex-col items-center justify-center shadow-md transition-all duration-300 ease-in-out",i=n?"cursor-pointer hover:shadow-xl hover:scale-105":"";return a&&t?(0,r.jsxs)("div",{className:o(l,"bg-card p-2",s,i),onClick:n,"data-ai-hint":"playing card",children:[(0,r.jsx)("div",{className:"flex w-full justify-start",children:(0,r.jsx)("span",{className:o("text-xl font-bold",j(t.suit)),children:t.rank})}),(0,r.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,r.jsx)("span",{className:o("text-4xl",j(t.suit)),children:t.suit})}),(0,r.jsx)("div",{className:"flex w-full justify-end rotate-180",children:(0,r.jsx)("span",{className:o("text-xl font-bold",j(t.suit)),children:t.rank})})]}):(0,r.jsx)("div",{className:o(l,"bg-secondary",s,i),onClick:n,"data-ai-hint":"card back",children:(0,r.jsx)("span",{className:"text-2xl text-secondary-foreground",children:"?"})})}let S=["♠","♥","♦","♣"],P=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],A=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];function O(){let e=[];return S.forEach(t=>{P.forEach(a=>{e.push({suit:t,rank:a,id:"".concat(t,"_").concat(a)})})}),e}let k="".concat("heart-attack-tw-game","/all");function R(e,t){let a=function(e){let t=[...e];for(let e=t.length-1;e>0;e--){let a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t}(O()),r=t.map(e=>({id:e.id,name:e.name,hand:[],isHost:e.isHost}));return!function(e,t){let a=e.length;0!==a&&(e.forEach(e=>e.hand=[]),t.forEach((t,r)=>{e[r%a].hand.push(t)}))}(r,a),{roomId:e,players:r,centerPile:[],currentTargetRank:A[0],currentPlayerIndex:0,gamePhase:"playing",winner:null,lastPlayedCard:null,gameMessage:"遊戲開始！輪到 ".concat(r[0].name," 出牌。目標：").concat(A[0]),slapInfo:null,turnNumber:1}}let _=0,E=new Map,C=e=>{if(E.has(e))return;let t=setTimeout(()=>{E.delete(e),G({type:"REMOVE_TOAST",toastId:e})},1e6);E.set(e,t)},M=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?C(a):e.toasts.forEach(e=>{C(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},D=[],H={toasts:[]};function G(e){H=M(H,e),D.forEach(e=>{e(H)})}function J(e){let{...t}=e,a=(_=(_+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>G({type:"DISMISS_TOAST",toastId:a});return G({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>G({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function L(){let[e,t]=s.useState(H);return s.useEffect(()=>(D.push(t),()=>{let e=D.indexOf(t);e>-1&&D.splice(e,1)}),[e]),{...e,toast:J,dismiss:e=>G({type:"DISMISS_TOAST",toastId:e})}}var F=a(6609),Q=a(5318);let U=F.Kq,V=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(F.LM,{ref:t,className:o("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",a),...s})});V.displayName=F.LM.displayName;let B=(0,l.F)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),z=s.forwardRef((e,t)=>{let{className:a,variant:s,...n}=e;return(0,r.jsx)(F.bL,{ref:t,className:o(B({variant:s}),a),...n})});z.displayName=F.bL.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(F.rc,{ref:t,className:o("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a),...s})}).displayName=F.rc.displayName;let Y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(F.bm,{ref:t,className:o("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":"",...s,children:(0,r.jsx)(Q.A,{className:"h-4 w-4"})})});Y.displayName=F.bm.displayName;let q=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(F.hE,{ref:t,className:o("text-sm font-semibold",a),...s})});q.displayName=F.hE.displayName;let K=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(F.VY,{ref:t,className:o("text-sm opacity-90",a),...s})});function W(){let{toasts:e}=L();return(0,r.jsxs)(U,{children:[e.map(function(e){let{id:t,title:a,description:s,action:n,...l}=e;return(0,r.jsxs)(z,{...l,children:[(0,r.jsxs)("div",{className:"grid gap-1",children:[a&&(0,r.jsx)(q,{children:a}),s&&(0,r.jsx)(K,{children:s})]}),n,(0,r.jsx)(Y,{})]},t)}),(0,r.jsx)(V,{})]})}function X(){var e,t,n,l,i,d,c,v,j,S,P;let[_,E]=(0,s.useState)(""),[C,M]=(0,s.useState)(""),[D,H]=(0,s.useState)(null),G=(0,s.useRef)(null),[J,F]=(0,s.useState)(!1),[Q,U]=(0,s.useState)(!1),[V,B]=(0,s.useState)(null),z=(0,s.useRef)(null),[Y,q]=(0,s.useState)([]),K=(0,s.useRef)(Y),[X,$]=(0,s.useState)(!1),[Z,ee]=(0,s.useState)(null),[et,ea]=(0,s.useState)(null),{toast:er}=L(),es=(0,s.useRef)(Q);(0,s.useEffect)(()=>{es.current=Q},[Q]),(0,s.useEffect)(()=>{K.current=Y},[Y]),(0,s.useEffect)(()=>{z.current=V},[V]);let en=(0,s.useCallback)(()=>{var e;return!!((null===(e=z.current)||void 0===e?void 0:e.players)||K.current).find(e=>e.id===D&&e.isHost)},[D]);(0,s.useEffect)(()=>{if(H("heart-attack-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,7))),!window.Buffer){let e=a(4134);window.Buffer=e.Buffer}window.global||(window.global=window)},[]);let el=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t||es.current;if(G.current&&D&&a&&_){let t={...e,roomId:_,senderId:D,timestamp:Date.now()};G.current.publish(k,JSON.stringify(t))}else console.warn("Publish suppressed:",{hasClient:!!G.current,clientId:D,currentJoinedState:a,roomCode:_,messageType:e.type})},[D,_]);(0,s.useEffect)(()=>{if(!G.current||!D||!Q)return;let e=G.current,t=(t,a)=>{if(t===k)try{let t=JSON.parse(a.toString());if(t.roomId!==_)return;console.log("Received message:",t);let d=!!K.current.find(e=>e.id===D&&e.isHost);if(d&&D&&z.current){let a=z.current,r=K.current;switch(t.type){case"ACTION_PLAY_CARD":{if(!a){console.warn("Host: ACTION_PLAY_CARD received but no game state ref.");return}let r=function(e,t){let a=JSON.parse(JSON.stringify(e));if("playing"!==a.gamePhase||a.players[a.currentPlayerIndex].id!==t)return a.gameMessage="錯誤：不是你的回合或遊戲狀態不允許出牌。","slapOpportunity"!==a.gamePhase&&(a.slapInfo=null),a;let r=a.players[a.currentPlayerIndex];if(0===r.hand.length){a.gamePhase="gameOver";let e=a.players.find(e=>e.id!==r.id);return a.winner=e?e.id:r.id,a.gameMessage="".concat(r.name," 沒有手牌了！遊戲結束。"),a.slapInfo=null,a}a.slapInfo=null;let s=r.hand.shift();if(a.centerPile.push(s),a.lastPlayedCard=s,s.rank===a.currentTargetRank)a.gamePhase="slapOpportunity",a.slapInfo={eligible:!0,attemptedBy:[],resolved:!1,message:"匹配！目標是 ".concat(a.currentTargetRank,"，牌面是 ").concat(s.rank,"！可以搶拍！"),penaltyPlayerId:void 0},a.gameMessage="".concat(r.name," 打出了 ").concat(s.rank).concat(s.suit,"。 ").concat(a.slapInfo.message);else{a.gamePhase="playing",a.currentPlayerIndex=(a.currentPlayerIndex+1)%a.players.length;let e=A.indexOf(a.currentTargetRank);a.currentTargetRank=A[(e+1)%A.length],a.gameMessage="".concat(r.name," 打出了 ").concat(s.rank).concat(s.suit,"。 輪到 ").concat(a.players[a.currentPlayerIndex].name,"。目標：").concat(a.currentTargetRank,"。")}return 0===r.hand.length&&"gameOver"!==a.gamePhase&&(a.gamePhase="gameOver",a.winner=r.id,a.gameMessage="遊戲結束！".concat(r.name," 打完了所有手牌，獲得勝利！"),a.slapInfo=null),a.turnNumber++,a}(a,t.senderId);z.current=r,B(r),e.publish(k,JSON.stringify({type:"GAME_STATE_UPDATE",gameState:r,roomId:_,senderId:D,timestamp:Date.now()}));return}case"ACTION_SLAP":{if(!a){console.warn("Host: ACTION_SLAP received but no game state ref.");return}let r=function(e,t){var a,r;let s=JSON.parse(JSON.stringify(e)),n=s.players.find(e=>e.id===t),l=s.players.find(e=>e.id!==t);if(!n||!l)return s;let i=!1,d="";if("slapOpportunity"===s.gamePhase&&s.slapInfo&&s.slapInfo.eligible&&!s.slapInfo.resolved?(i=!0,l.hand.push(...s.centerPile),d="".concat(n.name," 搶拍成功！").concat(l.name," 收走牌堆。"),s.slapInfo.attemptedBy.push({playerId:t,timestamp:Date.now()}),s.slapInfo.resolved=!0,s.slapInfo.message=d,s.slapInfo.penaltyPlayerId=l.id,0===n.hand.length?(s.gamePhase="gameOver",s.winner=n.id,s.slapInfo.message="遊戲結束！".concat(n.name," 搶拍成功並打完了所有手牌，獲得勝利！")):l.hand.length===O().length&&(s.gamePhase="gameOver",s.winner=n.id,s.slapInfo.message="遊戲結束！".concat(l.name," 擁有了所有牌，").concat(n.name," 獲勝！"))):(i=!1,n.hand.push(...s.centerPile),d="".concat(n.name," 錯誤搶拍！").concat(n.name," 收走牌堆。"),s.slapInfo={eligible:!1,attemptedBy:[{playerId:t,timestamp:Date.now()}],resolved:!0,message:d,penaltyPlayerId:n.id},0===l.hand.length?(s.gamePhase="gameOver",s.winner=l.id,s.slapInfo.message="遊戲結束！因 ".concat(n.name," 錯誤搶拍，").concat(l.name," 打完了所有手牌，獲得勝利！")):n.hand.length===O().length&&(s.gamePhase="gameOver",s.winner=l.id,s.slapInfo.message="遊戲結束！".concat(n.name," 錯誤搶拍並拿走了所有牌，").concat(l.name," 獲勝！"))),s.centerPile=[],s.lastPlayedCard=null,"gameOver"!==s.gamePhase){if(s.gamePhase="playing",i)s.currentPlayerIndex=s.players.findIndex(e=>e.id===l.id);else{let t=s.players.findIndex(t=>t.id===e.players[e.currentPlayerIndex].id);-1===t&&(t=0),s.currentPlayerIndex=(t+1)%s.players.length}let t=A.indexOf(e.currentTargetRank);s.currentTargetRank=A[(t+1)%A.length],s.gameMessage="".concat((null===(a=s.slapInfo)||void 0===a?void 0:a.message)||d," 輪到 ").concat(s.players[s.currentPlayerIndex].name,"。目標：").concat(s.currentTargetRank,"。")}else s.gameMessage=(null===(r=s.slapInfo)||void 0===r?void 0:r.message)||"遊戲結束！";return s.turnNumber++,s}(a,t.senderId);z.current=r,B(r),e.publish(k,JSON.stringify({type:"GAME_STATE_UPDATE",gameState:r,roomId:_,senderId:D,timestamp:Date.now()}));return}case"ACTION_NEW_GAME":{let t=a?a.players.map(e=>({id:e.id,name:e.name,isHost:e.isHost})):r;if(2===t.length){let a=R(_,t);z.current=a,B(a);let r={type:"GAME_START",initialGameState:a,roomId:_,senderId:D,timestamp:Date.now()};e.publish(k,JSON.stringify(r))}return}}}switch(t.type){case"JOIN_ROOM":q(a=>{let r=[...a],s={id:t.senderId,name:t.playerName,isHost:!1},n=r.findIndex(e=>e.id===s.id);-1!==n?r[n]={...r[n],name:s.name}:r.push(s),r.sort((e,t)=>e.id.localeCompare(t.id));let l=r.map((e,t)=>({...e,isHost:0===t}));if(K.current=l,l.find(e=>e.id===D&&e.isHost)&&2===l.length&&e&&!z.current){let t=R(_,l);z.current=t;let a={type:"GAME_START",initialGameState:t,roomId:_,senderId:D,timestamp:Date.now()};e.publish(k,JSON.stringify(a))}return t.senderId===D&&a.find(e=>e.id===D)?t.senderId!==D||1!==l.length||a.find(e=>e.id===D&&e.name===t.playerName)||setTimeout(()=>{er({title:"成功加入",description:"已加入房間 ".concat(_)})},0):setTimeout(()=>{er({title:"玩家加入",description:"".concat(t.playerName," ").concat(t.senderId===D?"(你)":""," 已加入房間！")})},0),l});break;case"GAME_START":z.current=t.initialGameState,B(t.initialGameState),q(t.initialGameState.players.map(e=>({id:e.id,name:e.name,isHost:e.isHost}))),setTimeout(()=>{er({title:"遊戲開始！",description:t.initialGameState.gameMessage})},0);break;case"GAME_STATE_UPDATE":var r,s,n,l,i;if(d&&t.senderId===D||(z.current=t.gameState),B(t.gameState),(null===(r=t.gameState.slapInfo)||void 0===r?void 0:r.message)&&t.gameState.slapInfo.resolved&&(setTimeout(()=>{er({title:"搶拍結果",description:t.gameState.slapInfo.message})},0),t.gameState.slapInfo.penaltyPlayerId?ea({type:"slap-wrong",targetPlayerId:t.gameState.slapInfo.penaltyPlayerId}):((null===(s=t.gameState.slapInfo.message)||void 0===s?void 0:s.includes("成功"))||(null===(n=t.gameState.slapInfo.message)||void 0===n?void 0:n.includes("較快")))&&ea({type:"slap-correct"}),setTimeout(()=>ea(null),1e3)),"gameOver"===t.gameState.gamePhase&&t.gameState.winner){let e=t.gameState.players.find(e=>e.id===t.gameState.winner),a=(null===(l=t.gameState.slapInfo)||void 0===l?void 0:l.resolved)&&(null===(i=t.gameState.slapInfo)||void 0===i?void 0:i.message)?t.gameState.slapInfo.message:"".concat((null==e?void 0:e.name)||"有玩家"," 獲勝！");setTimeout(()=>{er({title:"遊戲結束！",description:a})},0)}break;case"ERROR":ee(t.message),setTimeout(()=>{er({variant:"destructive",title:"錯誤",description:t.message})},0)}}catch(e){console.error("Failed to parse MQTT message:",e),ee("收到無法解析的訊息")}};return e.on("message",t),()=>{e&&("function"==typeof e.off?e.off("message",t):"function"==typeof e.removeListener&&e.removeListener("message",t))}},[D,_,Q,el,er]),(0,s.useEffect)(()=>()=>{G.current&&G.current.end()},[]),(0,s.useEffect)(()=>{if(V&&D){var e;V.players.find(e=>e.id===D)&&(null===(e=V.players[V.currentPlayerIndex])||void 0===e?void 0:e.id)===D&&"playing"===V.gamePhase?$(!0):$(!1)}else $(!1)},[V,D]);let ei=()=>{X&&V&&"playing"===V.gamePhase&&(ea({type:"card-played"}),setTimeout(()=>ea(null),500),el({type:"ACTION_PLAY_CARD"}))},ed=()=>{en()&&el({type:"ACTION_NEW_GAME"})};if(null==V||V.players.find(e=>e.id===D),null==V||V.players.find(e=>e.id!==D),!V||!Q)return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 bg-background text-foreground",children:[(0,r.jsxs)(f,{className:"w-full max-w-md shadow-xl",children:[(0,r.jsx)(p,{children:(0,r.jsx)(g,{className:"text-3xl font-headline text-center text-primary",children:"心臟病大亂鬥"})}),(0,r.jsxs)(x,{className:"space-y-4",children:[Z&&(0,r.jsxs)(y,{variant:"destructive",children:[" ",(0,r.jsx)(w.A,{className:"h-4 w-4"})," ",(0,r.jsx)(b,{children:"錯誤"})," ",(0,r.jsx)(N,{children:Z})," "]}),(0,r.jsx)(m,{placeholder:"房間代碼",value:_,onChange:e=>E(e.target.value.toUpperCase()),className:"text-lg"}),(0,r.jsx)(m,{placeholder:"玩家名稱",value:C,onChange:e=>M(e.target.value),className:"text-lg"}),(0,r.jsx)(u,{onClick:()=>{if(!_.trim()||!C.trim()||!D){ee("房間代碼和玩家名稱不能為空");return}ee(null),G.current&&G.current.options.clientId!==D&&G.current.end(!0),q([]),B(null),z.current=null;let e=window.mqtt.connect("wss://broker.emqx.io:8084/mqtt",{clientId:D,protocolVersion:5,clean:!0});G.current=e,e.on("connect",()=>{F(!0),e.subscribe(k,t=>{if(t){ee("訂閱 MQTT 主題失敗: "+t.message),console.error("Subscription error:",t),e.end(),F(!1);return}U(!0),setTimeout(()=>{el({type:"JOIN_ROOM",playerName:C},!0)},100)})}),e.on("error",e=>{ee("MQTT 連線錯誤: ".concat(e.message)),console.error("MQTT connection error:",e),F(!1),U(!1)}),e.on("close",()=>{F(!1),U(!1)}),e.on("offline",()=>{F(!1),U(!1),ee("MQTT 客戶端離線")}),e.on("reconnect",()=>{ee("MQTT 重新連線中...")})},disabled:J&&Q&&Y.some(e=>e.id===D),className:"w-full text-lg py-6 bg-primary hover:bg-primary/90 text-primary-foreground",children:J?Q&&Y.some(e=>e.id===D)?"已加入房間，等待中...":"連線中...":"加入/創建房間"}),Q&&Y.length<2&&Y.some(e=>e.id===D)&&(0,r.jsxs)("p",{className:"text-center text-muted-foreground",children:["等待另一位玩家加入 (",Y.length,"/2)..."]}),Y.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-center",children:"目前房間玩家:"}),(0,r.jsxs)("ul",{className:"list-none p-0 text-center",children:[" ",Y.map(e=>(0,r.jsxs)("li",{children:[e.name," ",e.id===D?"(你)":""," ",e.isHost?"[主持]":""]},e.id))," "]})]})]})]}),(0,r.jsx)(W,{})]});let eo=V.players.find(e=>e.id===D),ec=V.players.find(e=>e.id!==D);return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-between p-4 bg-background text-foreground",children:[(0,r.jsxs)("header",{className:"w-full flex justify-between items-center mb-4",children:[(0,r.jsxs)("h1",{className:"text-xl md:text-2xl font-headline text-primary",children:["心臟病 - 房間: ",_]}),(0,r.jsx)(u,{onClick:ed,variant:"outline",size:"sm",disabled:!en()||"gameOver"!==V.gamePhase,children:"新遊戲 (僅主持)"})]}),(0,r.jsxs)("div",{className:"w-full flex flex-col items-center mb-2 md:mb-4",children:[(0,r.jsx)("p",{className:"text-lg font-semibold",children:(null==ec?void 0:ec.name)||"對手"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["剩餘牌數: ",null!==(S=null==ec?void 0:null===(e=ec.hand)||void 0===e?void 0:e.length)&&void 0!==S?S:"N/A"]}),(null==et?void 0:et.type)==="slap-wrong"&&et.targetPlayerId===(null==ec?void 0:ec.id)&&(0,r.jsx)("div",{className:"animate-shake text-destructive-foreground bg-destructive p-1 rounded text-sm",children:"錯誤搶拍!"})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-2 md:space-y-4 my-auto",children:[(0,r.jsxs)("div",{className:"text-center p-3 border-2 border-dashed border-primary rounded-lg min-h-[180px] w-64 md:w-72 flex flex-col justify-center items-center",children:[(0,r.jsxs)("p",{className:"text-lg md:text-xl mb-1",children:["目前目標: ",(0,r.jsx)("span",{className:"font-bold text-primary text-2xl md:text-3xl",children:V.currentTargetRank})]}),(0,r.jsxs)("p",{className:"text-xs md:text-sm text-muted-foreground mb-1",children:["中間牌堆: ",V.centerPile.length," 張"]}),(0,r.jsx)("div",{className:o("transition-transform duration-300",(null==et?void 0:et.type)==="card-played"?"scale-110":""),children:V.lastPlayedCard?(0,r.jsx)(T,{card:V.lastPlayedCard,isFaceUp:!0}):(0,r.jsx)(T,{card:null,isFaceUp:!1})})]}),(0,r.jsxs)(u,{onClick:()=>{V&&("slapOpportunity"===V.gamePhase||"playing"===V.gamePhase)&&el({type:"ACTION_SLAP"})},disabled:"gameOver"===V.gamePhase||"slapOpportunity"!==V.gamePhase&&"playing"!==V.gamePhase,className:o("w-40 md:w-48 text-lg md:text-xl py-3 md:py-4","slapOpportunity"===V.gamePhase?"bg-destructive hover:bg-destructive/90 animate-pulseHard":"bg-primary hover:bg-primary/90 text-primary-foreground"),children:[(0,r.jsx)(I.A,{className:"mr-2 h-5 w-5"})," 搶拍"]}),V.gameMessage&&(0,r.jsx)("p",{className:o("text-center text-xs md:text-sm p-2 rounded-md min-w-[280px] max-w-md",(null===(t=V.slapInfo)||void 0===t?void 0:t.resolved)&&((null===(n=V.slapInfo.message)||void 0===n?void 0:n.includes("成功"))||(null===(l=V.slapInfo.message)||void 0===l?void 0:l.includes("較快")))?"bg-green-100 text-green-700":(null===(i=V.slapInfo)||void 0===i?void 0:i.resolved)&&((null===(d=V.slapInfo.message)||void 0===d?void 0:d.includes("錯誤"))||(null===(c=V.slapInfo.message)||void 0===c?void 0:c.includes("失敗")))?"bg-destructive/20 text-destructive":"text-primary bg-primary/10"),children:V.gameMessage}),(null==et?void 0:et.type)==="slap-correct"&&(0,r.jsx)("div",{className:"text-green-600 p-1 rounded text-sm bg-green-100",children:"搶拍成功!"})]}),(0,r.jsxs)("div",{className:"w-full flex flex-col items-center mt-2 md:mt-4",children:[(null==et?void 0:et.type)==="slap-wrong"&&et.targetPlayerId===(null==eo?void 0:eo.id)&&(0,r.jsx)("div",{className:"animate-shake text-destructive-foreground bg-destructive p-1 rounded text-sm",children:"錯誤搶拍!"}),(0,r.jsxs)("p",{className:"text-lg font-semibold",children:[(null==eo?void 0:eo.name)||"玩家"," (你) ",(null==eo?void 0:eo.isHost)&&"[主持]"]}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["剩餘牌數: ",null!==(P=null==eo?void 0:null===(v=eo.hand)||void 0===v?void 0:v.length)&&void 0!==P?P:"N/A"]}),(0,r.jsxs)("div",{className:"my-1 h-28 md:h-36 flex items-center justify-center",children:[" ",eo&&eo.hand&&eo.hand.length>0&&(0,r.jsx)(T,{card:eo.hand[0],isFaceUp:!1,onClick:X&&"playing"===V.gamePhase?ei:void 0})," "]}),(0,r.jsx)(u,{onClick:ei,disabled:!X||"playing"!==V.gamePhase,className:"w-40 md:w-48 text-lg md:text-xl py-3 md:py-4 bg-primary hover:bg-primary/90 text-primary-foreground",children:" 出牌 "})]}),"gameOver"===V.gamePhase&&V.winner&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:(0,r.jsxs)(f,{className:"p-6 md:p-8 text-center",children:[" ",(0,r.jsx)(g,{className:"text-2xl md:text-3xl mb-3",children:"遊戲結束！"})," ",(0,r.jsxs)(x,{children:[" ",(0,r.jsxs)("p",{className:"text-xl md:text-2xl",children:[null===(j=V.players.find(e=>e.id===V.winner))||void 0===j?void 0:j.name," 獲勝！"]})," "]})," ",(0,r.jsxs)(h,{className:"justify-center",children:[" ",(0,r.jsx)(u,{onClick:ed,disabled:!en(),className:"mt-3 text-lg",children:"再玩一局 (僅主持)"})," "]})," "]})}),(0,r.jsx)(W,{})]})}K.displayName=F.VY.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[246,441,684,358],()=>t(1312)),_N_E=e.O()}]);